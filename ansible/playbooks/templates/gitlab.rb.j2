## GitLab URL (direct access via internal network)
external_url 'https://{{ cert_common_name }}'

## GitLab bundled nginx SSL Configuration
nginx['enable'] = true
nginx['redirect_http_to_https'] = true
nginx['ssl_certificate'] = "{{ cert_dir }}/{{ cert_filename }}.crt"
nginx['ssl_certificate_key'] = "{{ cert_dir }}/{{ cert_filename }}.key"

## Trust Vault root CA for outbound connections
nginx['ssl_client_certificate'] = "/usr/local/share/ca-certificates/vault-root-ca.crt"

## Disable Let's Encrypt (we use Vault for certificates)
letsencrypt['enable'] = false

## Email configuration (using postfix)
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "localhost"
gitlab_rails['smtp_port'] = 25
gitlab_rails['smtp_domain'] = "homelab.lan"
gitlab_rails['smtp_tls'] = false
gitlab_rails['smtp_openssl_verify_mode'] = 'none'
gitlab_rails['smtp_enable_starttls_auto'] = false
gitlab_rails['smtp_ssl'] = false
gitlab_rails['smtp_force_ssl'] = false

## GitLab email from
gitlab_rails['gitlab_email_from'] = 'gitlab@homelab.lan'
gitlab_rails['gitlab_email_reply_to'] = 'noreply@homelab.lan'

## Disable usage ping
gitlab_rails['usage_ping_enabled'] = false

## Performance tuning for homelab (reduce resource usage)
puma['worker_processes'] = 2
sidekiq['max_concurrency'] = 10

## Backup configuration
gitlab_rails['manage_backup_path'] = true
gitlab_rails['backup_path'] = "/var/opt/gitlab/backups"
gitlab_rails['backup_keep_time'] = 604800  # 7 days
