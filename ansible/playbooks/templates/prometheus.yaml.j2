global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # Scrape Prometheus itself
  - job_name: 'prometheus'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['localhost:9090']

  # Scrape the specific LXC containers defined in playbook
  - job_name: 'homelab_services'
    scheme: https
    static_configs:
      - targets:
{% for target in scrape_targets %}
{% if target is mapping %}
        - '{{ target.name }}.{{ scrape_target_hostname }}:{{ target.port | default(9100) }}'
{% else %}
        - '{{ target }}.{{ scrape_target_hostname }}:9100'
{% endif %}
{% endfor %}

  # Scrape Nginx metrics (enabled by nginx_metrics_enabled variable)
{% if nginx_metrics_enabled | default(false) %}
  - job_name: 'nginx_metrics'
    scheme: http
    static_configs:
      - targets:
        - 'nginx.{{ scrape_target_hostname }}:9113'
{% endif %}
